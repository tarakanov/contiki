/// \addtogroup module_scif_driver_setup
//@{
#include "scif.h"
#include "scif_framework.h"
#ifdef DEVICE_FAMILY
    #define DEVICE_FAMILY_PATH(x) <ti/devices/DEVICE_FAMILY/x>
#else
    #define DEVICE_FAMILY_PATH(x) <x>
#endif
#include DEVICE_FAMILY_PATH(inc/hw_types.h)
#include DEVICE_FAMILY_PATH(inc/hw_memmap.h)
#include DEVICE_FAMILY_PATH(inc/hw_aon_event.h)
#include DEVICE_FAMILY_PATH(inc/hw_aon_rtc.h)
#include DEVICE_FAMILY_PATH(inc/hw_aon_wuc.h)
#include DEVICE_FAMILY_PATH(inc/hw_aux_sce.h)
#include DEVICE_FAMILY_PATH(inc/hw_aux_smph.h)
#include DEVICE_FAMILY_PATH(inc/hw_aux_evctl.h)
#include DEVICE_FAMILY_PATH(inc/hw_aux_aiodio.h)
#include DEVICE_FAMILY_PATH(inc/hw_aux_timer.h)
#include DEVICE_FAMILY_PATH(inc/hw_aux_wuc.h)
#include DEVICE_FAMILY_PATH(inc/hw_event.h)
#include DEVICE_FAMILY_PATH(inc/hw_ints.h)
#include DEVICE_FAMILY_PATH(inc/hw_ioc.h)
#include <string.h>
#if defined(__IAR_SYSTEMS_ICC__)
    #include <intrinsics.h>
#endif


// OSAL function prototypes
uint32_t scifOsalEnterCriticalSection(void);
void scifOsalLeaveCriticalSection(uint32_t key);




/// Firmware image to be uploaded to the AUX RAM
static const uint16_t pAuxRamImage[] = {
    /*0x0000*/ 0x1408, 0x040C, 0x1408, 0x042C, 0x1408, 0x0447, 0x1408, 0x044D, 0x4436, 0x2437, 0xAEFE, 0xADB7, 0x6442, 0x7000, 0x7C6B, 0x6871, 
    /*0x0020*/ 0x0068, 0x1425, 0x6872, 0x0069, 0x1425, 0x6873, 0x006A, 0x1425, 0x786B, 0xF801, 0xFA01, 0xBEF2, 0x786F, 0x6871, 0xFD0E, 0x6873, 
    /*0x0040*/ 0xED92, 0xFD06, 0x7C6F, 0x642D, 0x0450, 0x786B, 0x8F1F, 0xED8F, 0xEC01, 0xBE01, 0xADB7, 0x8DB7, 0x6630, 0x6542, 0x0000, 0x186F, 
    /*0x0060*/ 0x9D88, 0x9C01, 0xB60D, 0x1067, 0xAF19, 0xAA00, 0xB609, 0xA8FF, 0xAF39, 0xBE06, 0x0C6B, 0x8869, 0x8F08, 0xFD47, 0x9DB7, 0x086B, 
    /*0x0080*/ 0x8801, 0x8A01, 0xBEEC, 0x262F, 0xAEFE, 0x4630, 0x0450, 0x5527, 0x6642, 0x0000, 0x0C6B, 0x150D, 0x0450, 0x6742, 0x03FF, 0x0C6D, 
    /*0x00A0*/ 0x786C, 0x686D, 0xED37, 0xB605, 0x0000, 0x0C6C, 0x7C70, 0x652D, 0x0C6D, 0x786D, 0x686E, 0xFD0E, 0xF801, 0xE92B, 0xFD0E, 0xBE01, 
    /*0x00C0*/ 0x6436, 0xBDB7, 0x241A, 0xA6FE, 0xADB7, 0x641A, 0xADB7, 0x0000, 0x0095, 0x010C, 0x02EB, 0x0000, 0x0000, 0xFFFF, 0x0000, 0x0000, 
    /*0x00E0*/ 0x0000, 0x0000, 0x0000, 0x0000, 0x001E, 0x0003, 0x05DC, 0x0050, 0x0014, 0x0032, 0x03E8, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
    /*0x0100*/ 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
    /*0x0120*/ 0x0000, 0x0000, 0x0000, 0x0003, 0x0003, 0x00FD, 0x1462, 0x8B4A, 0xFD47, 0x8B4A, 0x1465, 0x16EC, 0x7001, 0x16F6, 0x0884, 0x1885, 
    /*0x0140*/ 0x8D21, 0x1874, 0x1C8E, 0x1874, 0x1C8F, 0x8A00, 0xBE5B, 0x7006, 0x1705, 0x7006, 0x1712, 0x705D, 0x6003, 0x171F, 0x7001, 0x1462, 
    /*0x0160*/ 0xFB4D, 0x8609, 0x7101, 0x6431, 0x2531, 0xA6FE, 0xFB00, 0x7078, 0xFB4C, 0x7003, 0xFB4C, 0xFD47, 0xFB4C, 0x1465, 0x6403, 0x001F, 
    /*0x0180*/ 0x8B2C, 0xFDB1, 0x8902, 0x0C7B, 0x087B, 0x1878, 0x8D29, 0xAE0A, 0x087B, 0x1876, 0x8D29, 0x9603, 0x0002, 0x0C84, 0x04D1, 0x0001, 
    /*0x01A0*/ 0x0C84, 0x04D4, 0x0001, 0x0C84, 0x7003, 0x1705, 0x7003, 0x1712, 0x705D, 0x6003, 0x171F, 0x7001, 0x1462, 0xFB4D, 0x8609, 0x7101, 
    /*0x01C0*/ 0x6431, 0x2531, 0xA6FE, 0xFB00, 0x7078, 0xFB4C, 0x7003, 0xFB4C, 0xFD47, 0xFB4C, 0x1465, 0x6403, 0x001F, 0x8B2C, 0xFDB1, 0x8902, 
    /*0x01E0*/ 0x0C7C, 0x1725, 0x087C, 0x1878, 0x8D29, 0xAE0A, 0x087C, 0x1876, 0x8D29, 0x9603, 0x0002, 0x0C85, 0x04FF, 0x0001, 0x0C85, 0x0502, 
    /*0x0200*/ 0x0001, 0x0C85, 0x1730, 0x0003, 0x8B0D, 0x8608, 0x7002, 0xFB0A, 0x7025, 0x173B, 0x6444, 0xADB7, 0xADB7, 0x00FD, 0x1462, 0x8B4A, 
    /*0x0220*/ 0xFD47, 0x8B4A, 0x1465, 0x16EC, 0x7006, 0x1705, 0x7006, 0x1712, 0x705D, 0x6003, 0x171F, 0x7001, 0x1462, 0xFB4D, 0x8609, 0x7101, 
    /*0x0240*/ 0x6431, 0x2531, 0xA6FE, 0xFB00, 0x7078, 0xFB4C, 0x7003, 0xFB4C, 0xFD47, 0xFB4C, 0x1465, 0x6403, 0x001F, 0x8B2C, 0xFDB1, 0x8902, 
    /*0x0260*/ 0x0C7B, 0x7003, 0x1705, 0x7003, 0x1712, 0x705D, 0x6003, 0x171F, 0x7001, 0x1462, 0xFB4D, 0x8609, 0x7101, 0x6431, 0x2531, 0xA6FE, 
    /*0x0280*/ 0xFB00, 0x7078, 0xFB4C, 0x7003, 0xFB4C, 0xFD47, 0xFB4C, 0x1465, 0x6403, 0x001F, 0x8B2C, 0xFDB1, 0x8902, 0x0C7C, 0x1725, 0x1730, 
    /*0x02A0*/ 0x0874, 0x1874, 0x8D21, 0x1874, 0x2874, 0x9D1A, 0x2875, 0x3875, 0xAD23, 0x3875, 0x4875, 0xBD1C, 0x4892, 0xC801, 0x4C92, 0x4884, 
    /*0x02C0*/ 0xCA01, 0xBE2E, 0x487B, 0x587A, 0xCD2D, 0x9609, 0x488E, 0xCD2B, 0x9E04, 0x488E, 0xC8FF, 0x4C8E, 0x056E, 0x3C8E, 0x057B, 0x487B, 
    /*0x02E0*/ 0x587A, 0xCD2D, 0x9E08, 0x488E, 0xCD2A, 0xA604, 0x488E, 0xC801, 0x4C8E, 0x057B, 0x2C8E, 0x488E, 0xCD2B, 0xBE06, 0x4890, 0xCA00, 
    /*0x0300*/ 0xBE02, 0x4001, 0x4C90, 0x058F, 0x488E, 0xCD2A, 0xBE08, 0x4890, 0xCA01, 0xBE05, 0x4881, 0xC801, 0x4C81, 0x4000, 0x4C90, 0x05E7, 
    /*0x0320*/ 0x4884, 0xCA02, 0xBE54, 0x487B, 0x5877, 0xCD2D, 0x9609, 0x4893, 0xCD29, 0x9E04, 0x4893, 0xC8FF, 0x4C93, 0x059F, 0x1C93, 0x05A8, 
    /*0x0340*/ 0x4893, 0xCD28, 0xA604, 0x4893, 0xC801, 0x4C93, 0x05A8, 0x0C93, 0x487B, 0x5878, 0xCD2D, 0x960B, 0x488E, 0xCD29, 0x9E04, 0x488E, 
    /*0x0360*/ 0xC8FF, 0x4C8E, 0x05B6, 0x1C8E, 0x4002, 0x4C7D, 0x05C8, 0x487B, 0x5876, 0xCD2D, 0xAE0B, 0x488E, 0xCD28, 0xA604, 0x488E, 0xC801, 
    /*0x0380*/ 0x4C8E, 0x05C5, 0x0C8E, 0x4001, 0x4C7D, 0x05C8, 0x4874, 0x4C8E, 0x488A, 0xCA01, 0xBE04, 0x4000, 0x4C8A, 0x4000, 0x4C7D, 0x487B, 
    /*0x03A0*/ 0x5877, 0xCD2D, 0x9609, 0x4893, 0xCD29, 0xBE05, 0x4890, 0xCA00, 0xBE02, 0x4001, 0x4C90, 0x05E7, 0x4893, 0xCD28, 0xAE08, 0x4890, 
    /*0x03C0*/ 0xCA01, 0xBE05, 0x487F, 0xC801, 0x4C7F, 0x4000, 0x4C90, 0x4885, 0xCA01, 0xBE2E, 0x087C, 0x187A, 0x8D29, 0x9609, 0x088F, 0x8D2B, 
    /*0x03E0*/ 0x9E04, 0x088F, 0x88FF, 0x0C8F, 0x05F6, 0x3C8F, 0x0603, 0x087C, 0x187A, 0x8D29, 0x9E08, 0x088F, 0x8D2A, 0xA604, 0x088F, 0x8801, 
    /*0x0400*/ 0x0C8F, 0x0603, 0x2C8F, 0x088F, 0x8D2B, 0xBE06, 0x0891, 0x8A00, 0xBE02, 0x0001, 0x0C91, 0x0617, 0x088F, 0x8D2A, 0xBE08, 0x0891, 
    /*0x0420*/ 0x8A01, 0xBE05, 0x0882, 0x8801, 0x0C82, 0x0000, 0x0C91, 0x066F, 0x2885, 0xAA02, 0xBE54, 0x287C, 0x3877, 0xAD2B, 0x9609, 0x2894, 
    /*0x0440*/ 0xAD29, 0x9E04, 0x2894, 0xA8FF, 0x2C94, 0x0627, 0x1C94, 0x0630, 0x2894, 0xAD28, 0xA604, 0x2894, 0xA801, 0x2C94, 0x0630, 0x0C94, 
    /*0x0460*/ 0x287C, 0x3878, 0xAD2B, 0x960B, 0x288F, 0xAD29, 0x9E04, 0x288F, 0xA8FF, 0x2C8F, 0x063E, 0x1C8F, 0x2002, 0x2C7E, 0x0650, 0x287C, 
    /*0x0480*/ 0x3876, 0xAD2B, 0xAE0B, 0x288F, 0xAD28, 0xA604, 0x288F, 0xA801, 0x2C8F, 0x064D, 0x0C8F, 0x2001, 0x2C7E, 0x0650, 0x2874, 0x2C8F, 
    /*0x04A0*/ 0x288B, 0xAA01, 0xBE04, 0x2000, 0x2C8B, 0x2000, 0x2C7E, 0x287C, 0x3877, 0xAD2B, 0x9609, 0x0894, 0x8D29, 0xBE05, 0x0891, 0x8A00, 
    /*0x04C0*/ 0xBE02, 0x0001, 0x0C91, 0x066F, 0x1894, 0x9D28, 0xAE08, 0x0891, 0x8A01, 0xBE05, 0x0880, 0x8801, 0x0C80, 0x0000, 0x0C91, 0x0888, 
    /*0x04E0*/ 0x8A01, 0xBE06, 0x0000, 0x0C88, 0x0000, 0x0C7F, 0x0000, 0x0C81, 0x0889, 0x8A01, 0xBE06, 0x0000, 0x0C89, 0x0000, 0x0C80, 0x0000, 
    /*0x0500*/ 0x0C82, 0x0884, 0x1885, 0x8D21, 0x8A00, 0xBE5B, 0x7006, 0x1705, 0x7006, 0x1712, 0x705D, 0x6003, 0x171F, 0x7041, 0x1462, 0xFB4D, 
    /*0x0520*/ 0x8609, 0x7101, 0x6431, 0x2531, 0xA6FE, 0xFB00, 0x7018, 0xFB4C, 0x7003, 0xFB4C, 0xFD47, 0xFB4C, 0x1465, 0x6403, 0x001F, 0x8B2C, 
    /*0x0540*/ 0xFDB1, 0x8902, 0x0C7B, 0x087B, 0x1878, 0x8D29, 0xAE0A, 0x087B, 0x1876, 0x8D29, 0x9603, 0x0002, 0x0C84, 0x06B0, 0x0001, 0x0C84, 
    /*0x0560*/ 0x06B3, 0x0001, 0x0C84, 0x7003, 0x1705, 0x7003, 0x1712, 0x705D, 0x6003, 0x171F, 0x7041, 0x1462, 0xFB4D, 0x8609, 0x7101, 0x6431, 
    /*0x0580*/ 0x2531, 0xA6FE, 0xFB00, 0x7018, 0xFB4C, 0x7003, 0xFB4C, 0xFD47, 0xFB4C, 0x1465, 0x6403, 0x001F, 0x8B2C, 0xFDB1, 0x8902, 0x0C7C, 
    /*0x05A0*/ 0x1725, 0x087C, 0x1878, 0x8D29, 0xAE0A, 0x087C, 0x1876, 0x8D29, 0x9603, 0x0002, 0x0C85, 0x06DE, 0x0001, 0x0C85, 0x06E1, 0x0001, 
    /*0x05C0*/ 0x0C85, 0x1730, 0x0879, 0x8B0D, 0x8608, 0x7022, 0xFB0A, 0x7025, 0x173B, 0x6444, 0xADB7, 0xADB7, 0x643C, 0x243D, 0xA6FE, 0x1462, 
    /*0x05E0*/ 0x7100, 0xFB4A, 0xFD47, 0xFB4A, 0x1465, 0xADB7, 0xF007, 0x1462, 0x600F, 0xEB50, 0x86FF, 0x6300, 0xEB53, 0x8680, 0x6000, 0xED8F, 
    /*0x0600*/ 0xEB4B, 0xFD47, 0xEB4B, 0x1465, 0xADB7, 0xF007, 0x1462, 0x86FF, 0x63F0, 0xEB50, 0x8680, 0x6000, 0xED8F, 0xEB48, 0xFD47, 0xEB48, 
    /*0x0620*/ 0x1465, 0xADB7, 0xF007, 0x1462, 0x86FF, 0x63F8, 0xEB51, 0x8680, 0x6000, 0xED8F, 0xEB49, 0xFD47, 0xEB49, 0x1465, 0xADB7, 0xFB0C, 
    /*0x0640*/ 0xEDA4, 0xEB09, 0x640B, 0xCDB1, 0xADB7, 0x1462, 0x7079, 0xFB55, 0x71FB, 0xFB54, 0xFD47, 0xFB54, 0x1465, 0x4431, 0x4400, 0xADB7, 
    /*0x0660*/ 0x1462, 0x86FF, 0x7300, 0xFB52, 0xFD47, 0xFB52, 0x1465, 0x443C, 0x243D, 0xAEFE, 0xADB7, 0x5527, 0x6642, 0x862B, 0xF200, 0xFB27, 
    /*0x0680*/ 0xADB7
};


/// Look-up table that converts from AUX I/O index to MCU IOCFG offset
static const uint8_t pAuxIoIndexToMcuIocfgOffsetLut[] = {
    120, 116, 112, 108, 104, 100, 96, 92, 28, 24, 20, 16, 12, 8, 4, 0
};


/** \brief Look-up table of data structure information for each task
  *
  * There is one entry per data structure (\c cfg, \c input, \c output and \c state) per task:
  * - [31:20] Data structure size (number of 16-bit words)
  * - [19:12] Buffer count (when 2+, first data structure is preceded by buffering control variables)
  * - [11:0] Address of the first data structure
  */
static const uint32_t pScifTaskDataStructInfoLut[] = {
//  cfg         input       output      state       
    0x007010E8, 0x00000000, 0x00B010F6, 0x00F0110C  // New task
};




// No task-specific initialization functions




// No task-specific uninitialization functions




/** \brief Initilializes task resource hardware dependencies
  *
  * This function is called by the internal driver initialization function, \ref scifInit().
  */
static void scifTaskResourceInit(void) {
    scifInitIo(3, AUXIOMODE_ANALOG, -1, 0);
    scifInitIo(6, AUXIOMODE_ANALOG, -1, 0);
    HWREG(AON_WUC_BASE + AON_WUC_O_AUXCLK) = (AON_WUC_AUXCLK_SRC_SCLK_HF | AON_WUC_AUXCLK_SCLK_HF_DIV_DIV2) | AON_WUC_AUXCLK_PWR_DWN_SRC_SCLK_LF;
    scifInitIo(5, AUXIOMODE_OUTPUT, -1, 0);
    scifInitIo(7, AUXIOMODE_OUTPUT, -1, 0);
    HWREG(AON_WUC_BASE + AON_WUC_O_AUXCLK) = (AON_WUC_AUXCLK_SRC_SCLK_HF | AON_WUC_AUXCLK_SCLK_HF_DIV_DIV2) | AON_WUC_AUXCLK_PWR_DWN_SRC_SCLK_LF;
    HWREG(AON_RTC_BASE + AON_RTC_O_CTL) |= AON_RTC_CTL_RTC_4KHZ_EN;
} // scifTaskResourceInit




/** \brief Uninitilializes task resource hardware dependencies
  *
  * This function is called by the internal driver uninitialization function, \ref scifUninit().
  */
static void scifTaskResourceUninit(void) {
    scifUninitIo(3, -1);
    scifUninitIo(6, -1);
    HWREG(AON_WUC_BASE + AON_WUC_O_AUXCLK) = (AON_WUC_AUXCLK_SRC_SCLK_HF | AON_WUC_AUXCLK_SCLK_HF_DIV_DIV2) | AON_WUC_AUXCLK_PWR_DWN_SRC_NONE;
    scifUninitIo(5, 0);
    scifUninitIo(7, 0);
    HWREG(AON_WUC_BASE + AON_WUC_O_AUXCLK) = (AON_WUC_AUXCLK_SRC_SCLK_HF | AON_WUC_AUXCLK_SCLK_HF_DIV_DIV2) | AON_WUC_AUXCLK_PWR_DWN_SRC_NONE;
    HWREG(AON_RTC_BASE + AON_RTC_O_CTL) &= ~AON_RTC_CTL_RTC_4KHZ_EN;
} // scifTaskResourceUninit




/** \brief Re-initializes I/O pins used by the specified tasks
  *
  * It is possible to stop a Sensor Controller task and let the System CPU borrow and operate its I/O
  * pins. For example, the Sensor Controller can operate an SPI interface in one application state while
  * the System CPU with SSI operates the SPI interface in another application state.
  *
  * This function must be called before \ref scifExecuteTasksOnceNbl() or \ref scifStartTasksNbl() if
  * I/O pins belonging to Sensor Controller tasks have been borrowed System CPU peripherals.
  *
  * \param[in]      bvTaskIds
  *     Bit-vector of task IDs for the task I/Os to be re-initialized
  */
void scifReinitTaskIo(uint32_t bvTaskIds) {
    if (bvTaskIds & (1 << SCIF_NEW_TASK_TASK_ID)) {
        scifReinitIo(3, -1);
        scifReinitIo(6, -1);
        scifReinitIo(5, -1);
        scifReinitIo(7, -1);
    }
} // scifReinitTaskIo




/// Driver setup data, to be used in the call to \ref scifInit()
const SCIF_DATA_T scifDriverSetup = {
    (volatile SCIF_INT_DATA_T*) 0x400E00D6,
    (volatile SCIF_TASK_CTRL_T*) 0x400E00DE,
    (volatile uint16_t*) 0x400E00CE,
    0x0000,
    sizeof(pAuxRamImage),
    pAuxRamImage,
    pScifTaskDataStructInfoLut,
    pAuxIoIndexToMcuIocfgOffsetLut,
    scifTaskResourceInit,
    scifTaskResourceUninit
};




// No task-specific API available


//@}


// Generated by WINDEV1612EVAL at 2017-05-24 05:02:38.444
